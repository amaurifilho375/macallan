{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Macallan / Club Avolta</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f7f7f7; }
    .macallan-wrap { max-width: 820px; margin: 30px auto; }
    .macallan-header { text-align: center; margin-bottom: 12px; }
    .macallan-card { padding: 28px; border-radius: 8px; background: #fff; box-shadow: 0 6px 18px rgba(0,0,0,0.05); }
    .macallan-legend { font-weight: 600; margin-bottom: 18px; font-size: 1.05rem; }
    .btn-macallan { background:#000; color:#fff; border:0; padding:12px 18px; width:100%; border-radius:6px; }
    .form-control { min-height:42px; }
    label.form-label { font-weight:600; font-size:0.95rem; }
    .field-group { margin-bottom: 12px; }
  </style>
</head>
<body>
  <div class="macallan-wrap">
    <div class="macallan-header">
      <img src="{% static 'customers/images/MACALLAN_CLUBAVOLTA_LOGO.png' %}" alt="ClubAvolta | Macallan" class="img-fluid mb-3" style="max-height:90px;">
      <div class="text-end">
        <a href="{% url 'customers_list' %}" class="btn btn-outline-secondary btn-sm">Consultar registros</a>
      </div>
    </div>

    <div class="macallan-card">
      <div class="macallan-legend">
        The Macallan quer enviar um copo de cristal com um convite para conhecer a nova loja da marca no embarque do T3 de GRU para os top clientes da marca no Club Avolta. Informe os dados para entrega abaixo.
      </div>

      <form method="post" id="macallan-form" novalidate>
        {% csrf_token %}

        <div class="row">
          <div class="col-md-6">
            <div class="field-group">
              <label class="form-label">{{ form.customer_name.label }}</label>
              {{ form.customer_name }}
              {% if form.customer_name.errors %}<div class="text-danger small">{{ form.customer_name.errors }}</div>{% endif %}
            </div>

            <div class="field-group">
              <label class="form-label">{{ form.vat_id.label }}</label>
              {{ form.vat_id }}
              {% if form.vat_id.errors %}<div class="text-danger small">{{ form.vat_id.errors }}</div>{% endif %}
            </div>

            <div class="field-group">
              <label class="form-label">{{ form.zipcode.label }}</label>
              {{ form.zipcode }}
              {% if form.zipcode.errors %}<div class="text-danger small">{{ form.zipcode.errors }}</div>{% endif %}
            </div>

            <div class="field-group">
              <label class="form-label">{{ form.street_number.label }}</label>
              {{ form.street_number }}
              {% if form.street_number.errors %}<div class="text-danger small">{{ form.street_number.errors }}</div>{% endif %}
            </div>
          </div>

          <div class="col-md-6">
            <div class="field-group">
              <label class="form-label">{{ form.customer_email.label }}</label>
              {{ form.customer_email }}
              {% if form.customer_email.errors %}<div class="text-danger small">{{ form.customer_email.errors }}</div>{% endif %}
            </div>

            <div class="field-group">
              <label class="form-label">{{ form.phone_number.label }}</label>
              {{ form.phone_number }}
              {% if form.phone_number.errors %}<div class="text-danger small">{{ form.phone_number.errors }}</div>{% endif %}
            </div>

            <div class="field-group">
              <label class="form-label">{{ form.street.label }}</label>
              {{ form.street }}
              {% if form.street.errors %}<div class="text-danger small">{{ form.street.errors }}</div>{% endif %}
            </div>

            <div class="field-group">
              <label class="form-label">{{ form.complement.label }}</label>
              {{ form.complement }}
              {% if form.complement.errors %}<div class="text-danger small">{{ form.complement.errors }}</div>{% endif %}
            </div>
          </div>
        </div> 

        <div class="row mt-2">
          <div class="col-md-6">
            <div class="field-group">
              <label class="form-label">{{ form.district.label }}</label>
              {{ form.district }}
              {% if form.district.errors %}<div class="text-danger small">{{ form.district.errors }}</div>{% endif %}
            </div>
          </div>

          <div class="col-md-4">
            <div class="field-group">
              <label class="form-label">{{ form.city.label }}</label>
              {{ form.city }}
              {% if form.city.errors %}<div class="text-danger small">{{ form.city.errors }}</div>{% endif %}
            </div>
          </div>

          <div class="col-md-2">
            <div class="field-group">
              <label class="form-label">{{ form.region.label }}</label>
              {{ form.region }}
              {% if form.region.errors %}<div class="text-danger small">{{ form.region.errors }}</div>{% endif %}
            </div>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-12">
            <button class="btn-macallan" type="submit">Enviar</button>
          </div>
        </div>

      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/imask"></script>
  <script>
    function safe(id){ return document.getElementById(id); }
    if (safe('vat')) IMask(safe('vat'), { mask: '000.000.000-00' });
    if (safe('phone')) IMask(safe('phone'), { mask: '(00) 00000-0000' });
    if (safe('zipcode')) IMask(safe('zipcode'), { mask: '00000-000' });

    if (safe('zipcode')) {
      safe('zipcode').addEventListener('blur', function() {
        const cep = this.value.replace(/\D/g,'');
        if (cep.length !== 8) return;
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(r => r.json())
          .then(data => {
            if (!data || data.erro) return;
            if (safe('street')) safe('street').value = data.logradouro || '';
            if (safe('district')) safe('district').value = data.bairro || '';
            if (safe('city')) safe('city').value = data.localidade || '';
            if (safe('region')) safe('region').value = data.uf || '';
          }).catch(console.error);
      });
    }

    const formEl = safe('macallan-form');
    if (formEl) formEl.addEventListener('submit', function(e){
      ['vat','phone','zipcode'].forEach(id=>{
        const el = safe(id); if (!el) return;
        el.value = el.value.replace(/\D/g,'');
      });
    });
  </script>
</body>
</html>
